local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local MarketplaceService = game:GetService("MarketplaceService")
local SoundService = game:GetService("SoundService")

-- Configuration
local CORRECT_KEY = "6eUI4BbLFe"
local KEY_LINK = "https://link-hub.net/1339614/cDSLkHpVbVr6"

-- Executor Detection
local executor = "Unknown"
if identifyexecutor then
    local name, version = identifyexecutor()
    executor = name .. " " .. version
elseif getexecutorname then
    executor = getexecutorname()
elseif syn and syn.executor then
    executor = syn.executor
end
local notSupportedMessage = (executor == "Unknown" or executor == nil) and "Executor not supported" or ("Executor: ".. executor .. " is not supported")

-- Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "NexisKeySystem"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = game:GetService("CoreGui")

-- Create Sounds
local ClickSound = Instance.new("Sound")
ClickSound.SoundId = "rbxassetid://111174530730534" -- Button click sound
ClickSound.Volume = 0.15
ClickSound.Parent = ScreenGui

local SuccessSound = Instance.new("Sound")
SuccessSound.SoundId = "rbxassetid://134221055367800" -- Success sound
SuccessSound.Volume = 0.85
SuccessSound.Parent = ScreenGui

local FailureSound = Instance.new("Sound")
FailureSound.SoundId = "rbxassetid://76112438721619" -- Soft dismiss tone
FailureSound.Volume = 0.85
FailureSound.Parent = ScreenGui

local FailureSound2 = Instance.new("Sound")
FailureSound2.SoundId = "rbxassetid://94922572272481"
FailureSound2.Volume = 0.85
FailureSound2.Parent = ScreenGui

-- Main Frame (460√ó300px)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 460, 0, 300)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui

-- Main Frame Border (1px #282828)
local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(40, 40, 40)
MainStroke.Thickness = 1
MainStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
MainStroke.Parent = MainFrame

-- Corner (10px radius)
local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 10)
MainCorner.Parent = MainFrame

-- Drop Shadow (0 6 24 rgba(0,0,0,0.5))
local Shadow = Instance.new("ImageLabel")
Shadow.Name = "DropShadow"
Shadow.BackgroundTransparency = 1
Shadow.Position = UDim2.new(0, -36, 0, -18)
Shadow.Size = UDim2.new(1, 72, 1, 36)
Shadow.ZIndex = -1
Shadow.Image = "rbxassetid://6015897843"
Shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
Shadow.ImageTransparency = 0.5
Shadow.ScaleType = Enum.ScaleType.Slice
Shadow.SliceCenter = Rect.new(49, 49, 450, 450)
Shadow.Parent = MainFrame

-- Title Bar (72px height, draggable)
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 72)
TitleBar.Position = UDim2.new(0, 0, 0, 0)
TitleBar.BackgroundTransparency = 1
TitleBar.Parent = MainFrame

-- Title (26px, GothamBlack, #FFFFFF)
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, -60, 0, 28)
Title.Position = UDim2.new(0, 30, 0, 24)
Title.BackgroundTransparency = 1
Title.Text = "NEXIS HUB"
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 26
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = MainFrame

-- Subtitle (13px, Gotham, #B4B4B4)
local Subtitle = Instance.new("TextLabel")
Subtitle.Name = "Subtitle"
Subtitle.Size = UDim2.new(1, -60, 0, 16)
Subtitle.Position = UDim2.new(0, 30, 0, 52)
Subtitle.BackgroundTransparency = 1
Subtitle.Text = MarketplaceService:GetProductInfo(game.PlaceId).Name .. " is supported"
Subtitle.Font = Enum.Font.Gotham
Subtitle.TextSize = 13
Subtitle.TextColor3 = Color3.fromRGB(180, 180, 180)
Subtitle.TextXAlignment = Enum.TextXAlignment.Left
Subtitle.Parent = MainFrame

-- Content Container (30px side padding)
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, -60, 0, 172)
ContentFrame.Position = UDim2.new(0, 30, 0, 72)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- Key Input Frame (40px height, 94% width)
local InputFrame = Instance.new("Frame")
InputFrame.Name = "InputFrame"
InputFrame.Size = UDim2.new(0.94, 0, 0, 40)
InputFrame.Position = UDim2.new(0.5, 0, 0, 0)
InputFrame.AnchorPoint = Vector2.new(0.5, 0)
InputFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
InputFrame.Parent = ContentFrame

local InputCorner = Instance.new("UICorner")
InputCorner.CornerRadius = UDim.new(0, 8)
InputCorner.Parent = InputFrame

local InputStroke = Instance.new("UIStroke")
InputStroke.Color = Color3.fromRGB(50, 50, 50)
InputStroke.Thickness = 1
InputStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
InputStroke.Parent = InputFrame

local DepthStroke = Instance.new("UIStroke")
DepthStroke.Color = Color3.fromRGB(255, 255, 255)
DepthStroke.Thickness = 1
DepthStroke.Transparency = 0.85
DepthStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
DepthStroke.Parent = InputFrame

-- TextBox (16px padding, 15px font, GothamMedium)
local KeyInput = Instance.new("TextBox")
KeyInput.Name = "KeyInput"
KeyInput.Size = UDim2.new(1, -32, 1, -32)
KeyInput.Position = UDim2.new(0.5, 0, 0.5, 0)
KeyInput.AnchorPoint = Vector2.new(0.5, 0.5)
KeyInput.BackgroundTransparency = 1
KeyInput.PlaceholderText = "Enter your key here..."
KeyInput.PlaceholderColor3 = Color3.fromRGB(136, 136, 136)
KeyInput.Text = ""
KeyInput.Font = Enum.Font.GothamMedium
KeyInput.TextSize = 15
KeyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
KeyInput.TextXAlignment = Enum.TextXAlignment.Center
KeyInput.ClearTextOnFocus = false
KeyInput.Parent = InputFrame

-- Focus Effects
KeyInput.Focused:Connect(function()
    TweenService:Create(InputStroke, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Color = Color3.fromRGB(255, 255, 255)
    }):Play()
end)

KeyInput.FocusLost:Connect(function()
    TweenService:Create(InputStroke, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Color = Color3.fromRGB(50, 50, 50)
    }):Play()
end)

-- Submit Button (40px height, 16px gap)
local SubmitButton = Instance.new("TextButton")
SubmitButton.Name = "SubmitButton"
SubmitButton.Size = UDim2.new(0.94, 0, 0, 40)
SubmitButton.Position = UDim2.new(0.5, 0, 0, 60)
SubmitButton.AnchorPoint = Vector2.new(0.5, 0)
SubmitButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
SubmitButton.Text = "SUBMIT KEY"
SubmitButton.Font = Enum.Font.GothamSemibold
SubmitButton.TextSize = 15
SubmitButton.TextColor3 = Color3.fromRGB(0, 0, 0)
SubmitButton.TextXAlignment = Enum.TextXAlignment.Center
SubmitButton.AutoButtonColor = false
SubmitButton.Parent = ContentFrame

local SubmitCorner = Instance.new("UICorner")
SubmitCorner.CornerRadius = UDim.new(0, 8)
SubmitCorner.Parent = SubmitButton

local SubmitScale = Instance.new("UIScale")
SubmitScale.Scale = 1
SubmitScale.Parent = SubmitButton

-- Get Key Button (40px height, 16px gap)
local GetKeyButton = Instance.new("TextButton")
GetKeyButton.Name = "GetKeyButton"
GetKeyButton.Size = UDim2.new(0.94, 0, 0, 40)
GetKeyButton.Position = UDim2.new(0.5, 0, 0, 112)
GetKeyButton.AnchorPoint = Vector2.new(0.5, 0)
GetKeyButton.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
GetKeyButton.Text = "GET KEY"
GetKeyButton.Font = Enum.Font.GothamSemibold
GetKeyButton.TextSize = 15
GetKeyButton.TextColor3 = Color3.fromRGB(234, 234, 234)
GetKeyButton.TextXAlignment = Enum.TextXAlignment.Center
GetKeyButton.AutoButtonColor = false
GetKeyButton.Parent = ContentFrame

local GetKeyCorner = Instance.new("UICorner")
GetKeyCorner.CornerRadius = UDim.new(0, 8)
GetKeyCorner.Parent = GetKeyButton

local GetKeyScale = Instance.new("UIScale")
GetKeyScale.Scale = 1
GetKeyScale.Parent = GetKeyButton

-- Notification Function
local function ShowNotification(message, isSuccess, isTopMiddle)
    local NotifFrame = Instance.new("Frame")
    NotifFrame.Size = isTopMiddle and UDim2.new(0, 400, 0, 64) or UDim2.new(0, 320, 0, 52)
    NotifFrame.Position = isTopMiddle and UDim2.new(0.5, -200, 0, 40) or UDim2.new(1, 20, 0, 20)
    NotifFrame.AnchorPoint = isTopMiddle and Vector2.new(0.5, 0) or Vector2.new(0, 0)
    NotifFrame.BackgroundTransparency = 1
    NotifFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    NotifFrame.Parent = ScreenGui

    local NotifCorner = Instance.new("UICorner")
    NotifCorner.CornerRadius = UDim.new(0, 8)
    NotifCorner.Parent = NotifFrame

    local NotifStroke = Instance.new("UIStroke")
    NotifStroke.Color = isSuccess and Color3.fromRGB(40, 180, 100) or Color3.fromRGB(255, 80, 80)
    NotifStroke.Thickness = 1
    NotifStroke.Transparency = 1
    NotifStroke.Parent = NotifFrame

    local NotifAccent = Instance.new("Frame")
    NotifAccent.Size = UDim2.new(0, 3, 1, 0)
    NotifAccent.Position = UDim2.new(0, 0, 0, 0)
    NotifAccent.BackgroundColor3 = isSuccess and Color3.fromRGB(40, 180, 100) or Color3.fromRGB(255, 80, 80)
    NotifAccent.BorderSizePixel = 0
    NotifAccent.BackgroundTransparency = 1
    NotifAccent.Parent = NotifFrame

    local NotifText = Instance.new("TextLabel")
    NotifText.Size = UDim2.new(1, -24, 1, 0)
    NotifText.Position = UDim2.new(0, 12, 0, 0)
    NotifText.BackgroundTransparency = 1
    NotifText.Text = message
    NotifText.Font = Enum.Font.GothamSemibold
    NotifText.TextSize = isTopMiddle and 16 or 15
    NotifText.TextColor3 = Color3.fromRGB(255, 255, 255)
    NotifText.TextTransparency = 1
    NotifText.TextXAlignment = Enum.TextXAlignment.Left
    NotifText.Parent = NotifFrame

    local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local targetPos = isTopMiddle and UDim2.new(0.5, -200, 0, 40) or UDim2.new(1, -340, 0, 20)
    TweenService:Create(NotifFrame, tweenInfo, { Position = targetPos, BackgroundTransparency = 0 }):Play()
    TweenService:Create(NotifText, tweenInfo, { TextTransparency = 0 }):Play()
    TweenService:Create(NotifStroke, tweenInfo, { Transparency = 0.4 }):Play()
    TweenService:Create(NotifAccent, tweenInfo, { BackgroundTransparency = 0 }):Play()

    task.delay(2.5, function()
        if not NotifFrame or NotifFrame.Parent == nil then return end
        local outTweenInfo = TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
        local fadeOut = TweenService:Create(NotifFrame, outTweenInfo, { BackgroundTransparency = 1 })
        TweenService:Create(NotifText, outTweenInfo, { TextTransparency = 1 }):Play()
        TweenService:Create(NotifStroke, outTweenInfo, { Transparency = 1 }):Play()
        TweenService:Create(NotifAccent, outTweenInfo, { BackgroundTransparency = 1 }):Play()
        fadeOut:Play()
        fadeOut.Completed:Connect(function()
            NotifFrame:Destroy()
        end)
    end)
end

-- Button Effects (Scale + Lift)
local function AddButtonEffect(button)
    local scale = button:FindFirstChildOfClass("UIScale")
    local originalColor = button.BackgroundColor3
    local originalPos = button.Position
    local hoverColor = button.Name == "SubmitButton" and Color3.fromRGB(230, 230, 230) or Color3.fromRGB(34, 34, 34)
    local hoverTweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local pressTweenInfo = TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

    button.MouseEnter:Connect(function()
        TweenService:Create(button, hoverTweenInfo, { BackgroundColor3 = hoverColor }):Play()
        TweenService:Create(scale, hoverTweenInfo, { Scale = 1.02 }):Play()
        TweenService:Create(button, hoverTweenInfo, { Position = originalPos + UDim2.new(0, 0, 0, -2) }):Play()
    end)

    button.MouseLeave:Connect(function()
        TweenService:Create(button, hoverTweenInfo, { BackgroundColor3 = originalColor }):Play()
        TweenService:Create(scale, hoverTweenInfo, { Scale = 1.0 }):Play()
        TweenService:Create(button, hoverTweenInfo, { Position = originalPos }):Play()
    end)

    button.MouseButton1Down:Connect(function()
        ClickSound:Play()
        TweenService:Create(scale, pressTweenInfo, { Scale = 0.98 }):Play()
    end)

    button.MouseButton1Up:Connect(function()
        TweenService:Create(scale, pressTweenInfo, { Scale = 1.02 }):Play()
    end)
end

AddButtonEffect(SubmitButton)
AddButtonEffect(GetKeyButton)

-- Submit Button Logic
SubmitButton.MouseButton1Click:Connect(function()
    local inputText = KeyInput.Text:gsub("%s+", "") -- Trim all whitespace (spacebar, Unicode)
    if inputText == "" then
        FailureSound:Play()
        ShowNotification("‚ùå Key cannot be empty", false, false)
        KeyInput.Text = ""
        task.spawn(function()
            local originalPos = InputFrame.Position
            local sequence = {5, -5, 3, -3, 0}
            local tweenInfo = TweenInfo.new(0.025, Enum.EasingStyle.Linear)
            for _, offset in ipairs(sequence) do
                local tween = TweenService:Create(InputFrame, tweenInfo, {
                    Position = originalPos + UDim2.fromOffset(offset, 0)
                })
                tween:Play()
                tween.Completed:Wait()
            end
        end)
        task.spawn(function()
            local originalColor = InputStroke.Color
            local errorColor = Color3.fromRGB(255, 59, 59)
            local focusedColor = Color3.fromRGB(255, 255, 255)
            local flashTween = TweenService:Create(InputStroke, TweenInfo.new(0.1), { Color = errorColor })
            flashTween:Play()
            flashTween.Completed:Wait()
            TweenService:Create(InputStroke, TweenInfo.new(0.15), { Color = focusedColor }):Play()
        end)
        return
    end

    if inputText == CORRECT_KEY then
        SuccessSound:Play()
        ShowNotification("‚úÖ Key Accepted! Loading...", true, false)
        local flashTween = TweenService:Create(MainFrame, TweenInfo.new(0.2, Enum.EasingStyle.Linear), { BackgroundColor3 = Color3.fromRGB(30, 30, 30) })
        flashTween:Play()
        flashTween.Completed:Connect(function()
            TweenService:Create(MainFrame, TweenInfo.new(0.2, Enum.EasingStyle.Linear), { BackgroundColor3 = Color3.fromRGB(20, 20, 20) }):Play()
        end)
        task.wait(1)

        FailureSound2:Play()
        ShowNotification("‚ùå " .. notSupportedMessage, false, true)
        task.wait(2.5)

        local exitTween = TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
            Position = MainFrame.Position + UDim2.fromOffset(0, 50),
            BackgroundTransparency = 1
        })

        for _, v in ipairs(MainFrame:GetDescendants()) do
            if v:IsA("UIStroke") then
                TweenService:Create(v, TweenInfo.new(0.3), { Transparency = 1 }):Play()
            elseif v:IsA("TextLabel") or v:IsA("TextButton") or v:IsA("TextBox") then
                TweenService:Create(v, TweenInfo.new(0.3), { TextTransparency = 1 }):Play()
            elseif v:IsA("ImageLabel") then
                TweenService:Create(v, TweenInfo.new(0.3), { ImageTransparency = 1 }):Play()
            end
        end

        exitTween:Play()
        exitTween.Completed:Wait()

        ScreenGui:Destroy()
        print("Key verified! Loading main script...")
    else
        FailureSound:Play()
        ShowNotification("‚ùå Invalid Key", false, false)
        KeyInput.Text = ""

        task.spawn(function()
            local originalPos = InputFrame.Position
            local sequence = {5, -5, 3, -3, 0}
            local tweenInfo = TweenInfo.new(0.025, Enum.EasingStyle.Linear)
            for _, offset in ipairs(sequence) do
                local tween = TweenService:Create(InputFrame, tweenInfo, {
                    Position = originalPos + UDim2.fromOffset(offset, 0)
                })
                tween:Play()
                tween.Completed:Wait()
            end
        end)

        task.spawn(function()
            local originalColor = InputStroke.Color
            local errorColor = Color3.fromRGB(255, 59, 59)
            local focusedColor = Color3.fromRGB(255, 255, 255)
            local flashTween = TweenService:Create(InputStroke, TweenInfo.new(0.1), { Color = errorColor })
            flashTween:Play()
            flashTween.Completed:Wait()
            TweenService:Create(InputStroke, TweenInfo.new(0.15), { Color = focusedColor }):Play()
        end)
    end
end)

-- Get Key Button Logic
GetKeyButton.MouseButton1Click:Connect(function()
    if setclipboard then
        setclipboard(KEY_LINK)
        SuccessSound:Play()
        ShowNotification("üìã Link Copied to Clipboard", true, false)
    else
        FailureSound:Play()
        ShowNotification("‚ùå Clipboard not available", false, false)
    end
end)

-- Draggable Logic
local dragging = false
local dragStart
local startPos

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)

TitleBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
        local snapPos = UDim2.new(
            startPos.X.Scale,
            math.round(MainFrame.Position.X.Offset),
            startPos.Y.Scale,
            math.round(MainFrame.Position.Y.Offset)
        )
        TweenService:Create(MainFrame, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Position = snapPos
        }):Play()
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

-- Entrance Animation (Fade + 10px upward slide)
local function EntranceAnimation()
    MainFrame.BackgroundTransparency = 1
    for _, v in ipairs(MainFrame:GetDescendants()) do
        if v:IsA("UIStroke") then v.Transparency = 1
        elseif v:IsA("TextLabel") or v:IsA("TextButton") or v:IsA("TextBox") then v.TextTransparency = 1
        elseif v:IsA("ImageLabel") then v.ImageTransparency = 1
        end
    end

    local startPosition = UDim2.new(0.5, 0, 0.5, 10)
    local endPosition = UDim2.new(0.5, 0, 0.5, 0)
    MainFrame.Position = startPosition

    local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    TweenService:Create(MainFrame, tweenInfo, { BackgroundTransparency = 0, Position = endPosition }):Play()

    for _, v in ipairs(MainFrame:GetDescendants()) do
        if v:IsA("UIStroke") then
            TweenService:Create(v, tweenInfo, { Transparency = v.Name == "MainStroke" and 0 or 0.85 }):Play()
        elseif v:IsA("TextLabel") or v:IsA("TextButton") or v:IsA("TextBox") then
            TweenService:Create(v, tweenInfo, { TextTransparency = 0 }):Play()
        elseif v:IsA("ImageLabel") and v.Name == "DropShadow" then
            TweenService:Create(v, tweenInfo, { ImageTransparency = 0.5 }):Play()
        end
    end
end

-- Micro-motion (Subtle Up-and-Down Animation)
local function StartBreathingAnimation()
    local breatheInfo = TweenInfo.new(4, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true)
    TweenService:Create(MainFrame, breatheInfo, { Position = UDim2.new(0.5, 0, 0.5, 10) }):Play()
end

EntranceAnimation()
StartBreathingAnimation()
